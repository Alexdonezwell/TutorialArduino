<head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
</head>

<p>
    Necklace sensor
</p>

<div id="tester" style="width:90%;height:70%;"></div>


<script type="text/javascript">
    window.onload = function() {
        TESTER = document.getElementById('tester');

        var N = 1000

        var count = 0

        var startTime = Date.now()

        signals = {
            time: [],
            top:  [],
            bottom: [],
            divide: []
        };

        var layout = {
            yaxis: {range:[0, 1024]}
        }

        var socket = io();

        socket.on('data', function (msg) {
            if (signals.time.length > N) {
                signals.time.shift();
                signals.top.shift();
                signals.bottom.shift();
                signals.divide.shift();
            }

            signals.time.push((msg.time - startTime)/1000)
            signals.top.push(msg.top)
            signals.bottom.push(msg.bottom)
            signals.divide.push(msg.top/msg.bottom)

            count = count + 1

            if (count > 100) {
                count = 0;
                var tr1 = {  x: signals.time,
                                y: signals.top,
                                name: 'Top sensor'}

                var tr2 = {  x: signals.time,
                                y: signals.bottom,
                                name: 'Bottom sensor'}

                var tr3 = {  x: signals.time,
                                y: signals.divide,
                                name: 'Swallow'}

                Plotly.newPlot( TESTER, [tr1, tr2, tr3], layout);
            }
        });
    }

</script>